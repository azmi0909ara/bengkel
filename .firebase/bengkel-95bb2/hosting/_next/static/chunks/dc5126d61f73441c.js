(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,66370,e=>{"use strict";var a=e.i(43476),r=e.i(71645);e.i(36180);var t=e.i(98925),i=e.i(59141);let s=["Servis Ringan","Servis Lengkap","Ganti Oli","Perbaikan Rem","Kelistrikan","Tune Up"];function d(){let[e,d]=(0,r.useState)([]),[n,l]=(0,r.useState)([]),[o,c]=(0,r.useState)([]),[u,g]=(0,r.useState)(""),[m,p]=(0,r.useState)(""),[b,x]=(0,r.useState)(""),[h,y]=(0,r.useState)([]),[v,f]=(0,r.useState)(""),[j,k]=(0,r.useState)([]);(0,r.useEffect)(()=>{(async()=>{let e=await (0,t.getDocs)((0,t.collection)(i.db,"pelanggan")),a=await (0,t.getDocs)((0,t.collection)(i.db,"kendaraan")),r=await (0,t.getDocs)((0,t.collection)(i.db,"stok"));d(e.docs.map(e=>({id:e.id,...e.data()}))),l(a.docs.map(e=>({id:e.id,...e.data()}))),c(r.docs.map(e=>({id:e.id,...e.data()})))})()},[]);let N=(e,a)=>{k(r=>{let t=[...r];return t[e].qty=Math.max(1,a),t})},S=j.reduce((e,a)=>e+a.harga*a.qty,0),w=Number(v||0)+S,q=async a=>{a.preventDefault();let r=e.find(e=>e.id===u),s=n.find(e=>e.id===m);if(r&&s){if(!b)return alert("Nama mekanik wajib diisi");if(0===h.length)return alert("Pilih minimal satu jenis servis");try{await (0,t.runTransaction)(i.db,async e=>{let a=[];for(let r of j){let s=(0,t.doc)(i.db,"stok",r.id),d=await e.get(s);if(!d.exists())throw Error(`Sparepart ${r.nama} tidak ditemukan`);let n=d.data().stok??0;if(n<r.qty)throw Error(`Stok ${r.nama} tidak mencukupi`);a.push({ref:s,currentStok:n,usedQty:r.qty})}let d=(0,t.doc)((0,t.collection)(i.db,"service"));for(let i of(e.set(d,{pelangganId:r.id,pelangganNama:r.nama,kendaraanId:s.id,kendaraanLabel:`${s.merk} - ${s.platNomor}`,mekanikNama:b,jenisServis:h,sparepart:j,biayaServis:Number(v),totalSparepart:S,totalBayar:w,status:"MENUNGGU",createdAt:t.Timestamp.now()}),a))e.update(i.ref,{stok:i.currentStok-i.usedQty})}),alert("Service berhasil disimpan"),g(""),p(""),x(""),y([]),k([]),f("")}catch(e){alert(e.message||"Gagal menyimpan service")}}};return(0,a.jsxs)("div",{className:"min-h-screen bg-gradient-to-br from-gray-900 via-gray-800 to-black p-6 text-white",children:[(0,a.jsx)("h1",{className:"text-2xl font-bold mb-6",children:"Service Kendaraan"}),(0,a.jsxs)("form",{onSubmit:q,className:"bg-gray-900 border border-gray-700 rounded-xl p-6 space-y-6",children:[(0,a.jsxs)("select",{className:"w-full bg-gray-800 border border-gray-700 rounded px-3 py-2",value:u,onChange:e=>g(e.target.value),required:!0,children:[(0,a.jsx)("option",{value:"",children:"Pilih Pelanggan"}),e.map(e=>(0,a.jsx)("option",{value:e.id,children:e.nama},e.id))]}),(0,a.jsxs)("select",{className:"w-full bg-gray-800 border border-gray-700 rounded px-3 py-2",value:m,onChange:e=>p(e.target.value),required:!0,children:[(0,a.jsx)("option",{value:"",children:"Pilih Kendaraan"}),n.filter(e=>e.pelangganId===u).map(e=>(0,a.jsxs)("option",{value:e.id,children:[e.merk," - ",e.platNomor]},e.id))]}),(0,a.jsx)("input",{placeholder:"Nama Mekanik",className:"w-full bg-gray-800 border border-gray-700 rounded px-3 py-2",value:b,onChange:e=>x(e.target.value),required:!0}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-gray-400 mb-2",children:"Jenis Servis"}),(0,a.jsx)("div",{className:"grid grid-cols-2 gap-2",children:s.map(e=>(0,a.jsxs)("label",{className:"flex items-center gap-2 bg-gray-800 border border-gray-700 rounded px-3 py-2",children:[(0,a.jsx)("input",{type:"checkbox",checked:h.includes(e),onChange:()=>{y(a=>a.includes(e)?a.filter(a=>a!==e):[...a,e])}}),e]},e))})]}),(0,a.jsx)("input",{type:"number",placeholder:"Biaya Jasa Servis",className:"w-full bg-gray-800 border border-gray-700 rounded px-3 py-2",value:v,onChange:e=>f(e.target.value),required:!0}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-gray-400 mb-2",children:"Tambah Sparepart"}),(0,a.jsx)("div",{className:"flex flex-wrap gap-2",children:o.map(e=>(0,a.jsx)("button",{type:"button",disabled:0===e.stok,onClick:()=>{0===e.stok||j.find(a=>a.id===e.id)||k(a=>[...a,{id:e.id,nama:e.nama,harga:e.harga,qty:1}])},className:`px-3 py-1 border rounded ${0===e.stok?"bg-gray-700 text-gray-500 cursor-not-allowed":"bg-gray-800 hover:bg-gray-700"}`,children:e.nama},e.id))})]}),j.map((e,r)=>(0,a.jsxs)("div",{className:"flex items-center justify-between bg-gray-800 p-3 rounded",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"font-semibold",children:e.nama}),(0,a.jsxs)("p",{className:"text-sm text-gray-400",children:["Rp ",e.harga.toLocaleString("id-ID")]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("button",{type:"button",onClick:()=>N(r,e.qty-1),className:"px-2 bg-gray-700 rounded",children:"-"}),(0,a.jsx)("span",{children:e.qty}),(0,a.jsx)("button",{type:"button",onClick:()=>N(r,e.qty+1),className:"px-2 bg-gray-700 rounded",children:"+"}),(0,a.jsx)("button",{type:"button",onClick:()=>{var a;return a=e.id,void k(e=>e.filter(e=>e.id!==a))},className:"ml-2 px-2 bg-red-600/20 text-red-400 rounded hover:bg-red-600/30",children:"âœ•"})]})]},e.id)),(0,a.jsxs)("div",{className:"bg-black/40 border border-gray-700 rounded p-4 text-sm",children:[(0,a.jsxs)("p",{children:["Total Sparepart: Rp"," ",S.toLocaleString("id-ID")]}),(0,a.jsxs)("p",{className:"text-lg font-bold text-red-500",children:["Total Bayar: Rp ",w.toLocaleString("id-ID")]})]}),(0,a.jsx)("button",{className:"w-full bg-red-600 hover:bg-red-700 transition rounded py-2 font-semibold",children:"Simpan Service"})]})]})}e.s(["default",()=>d])}]);